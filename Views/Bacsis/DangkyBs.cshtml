@{
    ViewData["Title"] = "DangkyBs";
    <link rel="stylesheet" href="~/css/Dangky.css" asp-append-version="true" />
}

<body>
    <h2>Đăng ký bác sĩ</h2>
    <div class="form-container">
        <form action="~/Bacsis/ThucHienDKBs" method="post" enctype="multipart/form-data">

            <label for="hinhanh">Ảnh đại diện</label>
            <input type="file" id="hinhanh" name="hinhanh" accept="image/*" required>
            <div id="preview-container" style="margin-top: 10px;">
                <img id="preview" src="" alt="Ảnh xem trước" style="max-width: 200px; max-height: 200px; display: none; border: 1px solid #ccc; padding: 5px;">
            </div>

            <label for="username">Tên Người dùng <span class="required">(Bắt buộc nhập)</span></label>
            <input type="text" id="username" name="username" required>

            <div>
                <label for="password">Mật khẩu <span class="required">(Bắt buộc nhập)</span></label>
                <input type="password" id="password" name="password" required>
                <p id="password-error" style="color: red; font-size: 12px; margin: 5px 0 0;"></p>
            </div>

            <div>
                <label for="confirm-password">Nhập lại mật khẩu <span class="required">(Bắt buộc nhập)</span></label>
                <input type="password" id="confirm-password" name="confirm-password" required>
                <p id="confirm-password-error" style="color: red; font-size: 12px; margin: 5px 0 0;"></p>
            </div>

            <label for="birthyear">Năm sinh <span class="required">(Bắt buộc nhập)</span></label>
            <input type="date" id="birthyear" name="birthyear" required>
            <p id="birth-error" style="color: red; font-size: 12px; margin: 5px 0 0;"></p>

            <label for="cmtnumber">Số CMT <span class="required">(Bắt buộc nhập)</span></label>
            <input type="text" id="cmtnumber" name="cmtnumber" placeholder="Số CMT" required pattern="\d*" title="Vui lòng nhập số">

            <input type="date" id="issuedate" name="issuedate" placeholder="Ngày cấp" required>
            <input type="text" id="issueplace" name="issueplace" placeholder="Nơi cấp" required>

            <div>
                <label for="cmt-image-front">Ảnh CMT mặt trước <span class="required">(Bắt buộc nhập)</span></label>
                <input type="file" id="cmt-image-front" name="cmtimagefront" accept="image/*" required>
                <div id="preview-front-container" style="margin-top: 10px;">
                    <img id="preview-front" src="" alt="Xem trước mặt trước" style="max-width: 200px; max-height: 200px; display: none; border: 1px solid #ccc; padding: 5px;">
                </div>
            </div>

            <div>
                <label for="cmt-image-back">Ảnh CMT mặt sau <span class="required">(Bắt buộc nhập)</span></label>
                <input type="file" id="cmtimageback" name="cmtimageback" accept="image/*" required>
                <div id="preview-back-container" style="margin-top: 10px;">
                    <img id="preview-back" src="" alt="Xem trước mặt sau" style="max-width: 200px; max-height: 200px; display: none; border: 1px solid #ccc; padding: 5px;">
                </div>
            </div>

            <label for="gender">Giới tính <span class="required">(Bắt buộc nhập)</span></label>
            <select id="gender" name="gender" required>
                <option value="">Chọn giới tính</option>
                <option value="male">Nam</option>
                <option value="female">Nữ</option>
            </select>

            <div>
                <label for="email">Email <span class="required">(Bắt buộc nhập)</span></label>
                <input type="email" id="email" name="email" required>
                <div id="email-error" style="color: red; font-size: 12px; display: none;">Email không hợp lệ hoặc không tồn tại.</div>
            </div>

            <div>
                <label for="phone">Số điện thoại <span class="required">(Bắt buộc nhập)</span></label>
                <input type="text" id="phone" name="phone" required>
                <div id="phone-error" style="color: red; font-size: 12px; display: none;">
                    Số điện thoại không đúng định dạng Việt Nam. Phải bắt đầu bằng 03, 05, 07, 08, hoặc 09 và có độ dài 10 hoặc 11 chữ số.
                </div>
            </div>



            <label for="diaChi">Địa chỉ</label>
            <input type="text" id="diaChi" name="diaChi" placeholder="Địa chỉ">

            <label for="namKinhNghiem">Năm kinh nghiệm <span class="required">(Bắt buộc nhập)</span></label>
            <input type="number" id="namKinhNghiem" name="namKinhNghiem" required>
            <!--Nơi công tác-->
            <label for="noiCongTac">Nơi công tác <span class="required">(Bắt buộc chọn)</span></label>
            <select id="noiCongTac" name="noiCongTac" required>
                <option value="">-- Hãy chọn bệnh viện công tác --</option>
                @foreach (var benhVien in ViewBag.bv)
                {
                    <option value="@benhVien[0]">@benhVien[1]</option>
                }
            </select>

            <label for="khoa">Khoa <span class="required">(Bắt buộc chọn)</span></label>
            <select id="khoa" name="khoa" required>
                <option value="">-- Hãy chọn khoa --</option>
                @if (ViewBag.kb != null)
                {
                    foreach (var kb in ViewBag.kb)
                    {
                        <option value="@kb[0]">@kb[1]</option>
                    }
                }
                else
                {
                    <option value="">Không có khoa nào</option>
                }
            </select>

            <label for="chuyenKhoa">Chuyên khoa <span class="required">(Bắt buộc chọn)</span></label>
            <select id="chuyenKhoa" name="chuyenKhoa" required>
                <option value="">-- Hãy chọn chuyên khoa --</option>
                @if (ViewBag.cn != null)
                {
                    foreach (var ck in ViewBag.cn)
                    {
                        <option value="@ck[1]">@ck[1]</option>
                    }
                }
                else
                {
                    <option value="">Không có chuyên khoa nào</option>
                }
            </select>

            <label for="soChungChi">Số chứng chỉ hành nghề <span class="required">(Bắt buộc nhập)</span></label>
            <input type="text" id="soChungChi" name="soChungChi" required >

            <label for="ngayThangCap">Ngày tháng cấp <span class="required">(Bắt buộc nhập)</span></label>
            <input type="date" id="ngayThangCap" name="ngayThangCap" required>

            <label for="noiCap">Nơi cấp <span class="required">(Bắt buộc nhập)</span></label>
            <input type="text" id="noiCap" name="noiCap" required>

            <div>
                <label for="anhChungChi1">Ảnh chứng chỉ hành nghề 1 <span class="required">(Bắt buộc nhập)</span></label>
                <input type="file" id="anhChungChi1" name="anhChungChi1" accept="image/*" required>
                <div id="preview-container1" style="margin-top: 10px;">
                    <img id="preview1" src="" alt="Xem trước chứng chỉ 1" style="max-width: 200px; max-height: 200px; display: none; border: 1px solid #ccc; padding: 5px;">
                </div>
            </div>

            <div>
                <label for="anhChungChi2">Ảnh chứng chỉ hành nghề 2 <span class="required">(Bắt buộc nhập)</span></label>
                <input type="file" id="anhChungChi2" name="anhChungChi2" accept="image/*" required>
                <div id="preview-container2" style="margin-top: 10px;">
                    <img id="preview2" src="" alt="Xem trước chứng chỉ 2" style="max-width: 200px; max-height: 200px; display: none; border: 1px solid #ccc; padding: 5px;">
                </div>
            </div>

            <label for="hocVi">Học vị</label>
            <select id="hocVi" name="hocVi">
                <option value="">-- Hãy chọn học vị --</option>
                <option value="Cử nhân">Cử nhân</option>
                <option value="Thạc sĩ">Thạc sĩ</option>
                <option value="Tiến sĩ">Tiến sĩ</option>
                <option value="Giáo sư">Giáo sư</option>
                <option value="Phó giáo sư">Phó giáo sư</option>
            </select>

            <label for="hocHam">Học hàm</label>
            <select id="hocHam" name="hocHam">
                <option value="">-- Hãy chọn học hàm --</option>
                <option value="Phó giáo sư">Phó giáo sư</option>
                <option value="Giáo sư">Giáo sư</option>
            </select>

            <label for="chuyenMon">Chuyên môn <span class="required">(Bắt buộc nhập)</span></label>
            <select id="chuyenMon" name="chuyenMon" required>
                <option value="">-- Hãy chọn chuyên môn --</option>
                <option value="Bác sĩ">Bác sĩ</option>
                <option value="Y tá">Y tá</option>
                <option value="Dược sĩ">Dược sĩ</option>
                <option value="Điều dưỡng viên">Điều dưỡng viên</option>
            </select>


            <label for="cacBenhDieuTri">Các bệnh điều trị <span class="required">(Bắt buộc nhập)</span></label>
            <textarea id="cacBenhDieuTri" name="cacBenhDieuTri" required></textarea>

            <label for="gioithieu">Giới thiệu <span class="required">(Bắt buộc nhập)</span></label>
            <textarea id="gioithieu" name="gioithieu" required></textarea>

            <label for="thontinbangcap">Thông tin bằng cấp</label>
            <textarea id="thontinbangcap" name="thontinbangcap" required></textarea>

            <label for="quaTrinhhoc">Quá trình Học</label>
            <textarea id="quaTrinhhoc" name="quaTrinhhoc" required></textarea>

            <label for="quaTrinhCongTac">Quá trình công tác</label>
            <textarea id="quaTrinhCongTac" name="quaTrinhCongTac" required></textarea>

            <label for="khamChuaBenh">Khám chữa bệnh</label>
            <textarea id="khamChuaBenh" name="khamChuaBenh" required></textarea>

            <label for="nghienCuuKhoaHoc">Nghiên cứu khoa học</label>
            <textarea id="nghienCuuKhoaHoc" name="nghienCuuKhoaHoc" required></textarea>

            <label for="giangDay">Giảng dạy</label>
            <textarea id="giangDay" name="giangDay" required></textarea>

            <label for="hoiVienCongTac">Hội viên công tác</label>
            <textarea id="hoiVienCongTac" name="hoiVienCongTac" required></textarea>

            <label for="quanLy">Quản lý</label>
            <textarea id="quanLy" name="quanLy" required></textarea>

            <button type="submit" class="submit-button" onclick="handleSubmit()">Đăng ký</button>

            <a href="@Url.Action("Index","Home")" class="quaylai-button">Quay lại Trang chủ</a>
        </form>
    </div>
    <script>
        //Đăng ký thành công
         function handleSubmit() {
        // Hiển thị thông báo trong console
        console.log("Đăng ký thành công, chờ đơn xác nhận từ người quản lý");

        // Nếu muốn ngừng việc gửi form, bạn có thể thêm dòng này
        event.preventDefault();
    }
    // Hàm thiết lập xem trước ảnh
function setupImagePreview(inputId, previewId) {
    const fileInput = document.getElementById(inputId);
    const previewImage = document.getElementById(previewId);

    fileInput.addEventListener("change", function () {
        const file = fileInput.files[0]; // Lấy file đã chọn

        if (file) {
            const reader = new FileReader();

            // Khi file được đọc xong, hiển thị ảnh
            reader.onload = function (e) {
                previewImage.src = e.target.result; // Gán URL ảnh
                previewImage.style.display = "block"; // Hiển thị ảnh
            };

            reader.readAsDataURL(file); // Đọc file dưới dạng URL
        } else {
            // Nếu không có ảnh, ẩn ảnh xem trước
            previewImage.src = "";
            previewImage.style.display = "none";
        }
    });
}

// Sử dụng setupImagePreview cho từng trường input file
setupImagePreview("hinhanh", "preview"); // Xem trước ảnh đại diện
setupImagePreview("cmt-image-front", "preview-front"); // Xem trước ảnh CMT mặt trước
setupImagePreview("cmtimageback", "preview-back"); // Xem trước ảnh CMT mặt sau
setupImagePreview("anhChungChi1", "preview1"); // Xem trước ảnh chứng chỉ 1
setupImagePreview("anhChungChi2", "preview2"); // Xem trước ảnh chứng chỉ 2

    const passwordInput = document.getElementById("password");
    const confirmPasswordInput = document.getElementById("confirm-password");
    const passwordError = document.getElementById("password-error");
    const confirmPasswordError = document.getElementById("confirm-password-error");

    // Kiểm tra mật khẩu khi gõ
    passwordInput.addEventListener("input", function () {
        const password = passwordInput.value;
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

        if (!passwordRegex.test(password)) {
            passwordError.textContent = "Mật khẩu phải gồm ít nhất 8 ký tự, bao gồm cả chữ và số.";
        } else {
            passwordError.textContent = "";
        }
    });

    // Kiểm tra mật khẩu nhập lại khi gõ
    confirmPasswordInput.addEventListener("input", function () {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (confirmPassword !== password) {
            confirmPasswordError.textContent = "Mật khẩu nhập lại không khớp.";
        } else {
            confirmPasswordError.textContent = "";
        }
    });

    // Kiểm tra lần cuối khi submit
    document.getElementById("passwordForm").addEventListener("submit", function (event) {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

        // Nếu có lỗi thì ngăn gửi form
        if (!passwordRegex.test(password) || confirmPassword !== password) {
            event.preventDefault();
        }
    });

    //kiểm tra tuổi
    const birthInput = document.getElementById("birthyear");
    const birthError = document.getElementById("birth-error");

    // Kiểm tra khi ngày sinh thay đổi
    birthInput.addEventListener("change", function () {
        const birthDate = new Date(birthInput.value);
        const today = new Date();

        // Tính tuổi
        const age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        const dayDiff = today.getDate() - birthDate.getDate();

        // Kiểm tra nếu chưa đủ 18 tuổi
        if (age < 18 || (age === 18 && (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)))) {
            birthError.textContent = "Bạn phải đủ 18 tuổi.";
        } else {
            birthError.textContent = "";
        }
    });
const phoneInput = document.getElementById("phone");
const phoneError = document.getElementById("phone-error");

// Kiểm tra số điện thoại khi gõ
phoneInput.addEventListener("input", function () {
    const phone = phoneInput.value;
    const phoneRegex = /^(0[3|5|7|8|9])+([0-9]{8})$/;

    if (!phoneRegex.test(phone)) {
        phoneError.textContent = "Số điện thoại không đúng định dạng Việt Nam. Phải bắt đầu bằng 03, 05, 07, 08, hoặc 09 và có độ dài 10 hoặc 11 chữ số.";
    } else {
        phoneError.textContent = ""; // Ẩn thông báo lỗi nếu hợp lệ
    }
});

</script>

</body>
