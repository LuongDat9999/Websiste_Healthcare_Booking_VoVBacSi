@{
    ViewData["Title"] = "Video Call - Start";
    Layout=null;
}

<h2>Video Call</h2>

<p>Room ID: @Model.RoomId</p>
<p>User ID: @Model.UserId</p>

<div>
    <button onclick="startVideoCall()">Start Call</button>
    <button onclick="endVideoCall()">End Call</button>
</div>

<div id="local_stream"></div>  <!-- Vùng chứa video của người tham gia -->
<div id="remote_stream"></div> <!-- Vùng chứa video của người khác -->

<script src="https://cdn.agora.io/sdk/web/AgoraRTCSDK-4.0.0.js"></script>
<script>
    const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });

    function startVideoCall() {
        client.init("YOUR_APP_ID", () => {
            console.log("AgoraRTC client initialized");

            client.join(null, "room1", null, (uid) => {
                console.log("User " + uid + " joined the channel");

                // Tạo stream để gửi video
                const localStream = AgoraRTC.createStream({
                    streamID: uid,
                    audio: true,
                    video: true,
                    screen: false
                });

                localStream.init(() => {
                    localStream.play("local_stream");
                    client.publish(localStream, (err) => {
                        console.log("Publish stream error: " + err);
                    });
                });
            });
        }, (err) => {
            console.log("AgoraRTC client init failed", err);
        });
    }

    function endVideoCall() {
        client.leave(() => {
            console.log("Left the channel");
        }, (err) => {
            console.log("Leave channel failed", err);
        });
    }
</script>
